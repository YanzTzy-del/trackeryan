<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Project Tracker YanZy ‚Äî NIK & IP Checker</title>
<!-- Axios untuk convenience (fetch juga dipakai) -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
  :root{
    --bg1:#071029; --bg2:#0b4f6c; --card:#071428; --accent:#60a5fa;
    --success:#22c55e; --danger:#ff5252; --muted:rgba(255,255,255,0.7);
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; font-family:Inter, system-ui, Arial;
    background: linear-gradient(120deg,var(--bg1), #073b4c 60%);
    color:#e6eef6; display:flex; align-items:center; justify-content:center; padding:28px;
  }
  .app{ width:100%; max-width:1100px; display:grid; grid-template-columns:320px 1fr; gap:20px; }
  .card{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px; border-radius:12px; box-shadow:0 10px 30px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03); }
  .brand{display:flex;gap:12px;align-items:center;margin-bottom:8px}
  .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;color:#071428;font-weight:700}
  h1{margin:0;font-size:18px}
  label{display:block;margin-top:10px;color:var(--muted);font-size:13px}
  input[type=text], input[type=password], select{width:100%;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:inherit;margin-top:8px}
  button{padding:10px 12px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--accent),#7c3aed);color:#071428;font-weight:700;cursor:pointer;margin-top:10px}
  button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  pre.result{background:#021026;color:#dff5e1;padding:12px;border-radius:8px;overflow:auto;font-size:13px}
  .muted{color:var(--muted);font-size:13px}
  .small{font-size:13px;color:var(--muted);margin-top:6px}
  .hidden{display:none}
  ul{padding-left:16px;margin:6px 0;color:var(--muted)}
  .user-row{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
  .danger{background:var(--danger);color:white;padding:6px 8px;border-radius:8px;border:none;cursor:pointer}
  .flex{display:flex;gap:8px;align-items:center}
  @media (max-width:900px){ .app{grid-template-columns:1fr} }
</style>
</head>
<body>
  <div class="app">
    <!-- LEFT: Login / Menu -->
    <div class="card">
      <div class="brand">
        <div class="logo">YZ</div>
        <div>
          <h1>Project Tracker YanZy</h1>
          <div class="muted">NIK & IP checker ‚Äî nama/nomor dari nama.json & nomer.json (deterministik)</div>
        </div>
      </div>

      <!-- Login -->
      <div id="loginBox">
        <label>Username</label>
        <input id="loginUser" type="text" placeholder="">
        <label>Password</label>
        <input id="loginPass" type="password" placeholder="">
        <button onclick="doLogin()">Login</button>
        <div class="small" id="loginMsg"></div>
      </div>

      <!-- Menu shown after login -->
      <div id="menuBox" class="hidden">
        <div class="small">Login sebagai: <strong id="roleLabel"></strong></div>
        <div style="margin-top:12px" class="flex">
          <button onclick="showPanel('nikPanel')">üÜî Cek NIK</button>
          <button onclick="showPanel('ipPanel')" style="background:linear-gradient(90deg,#f0b429,#ff6b6b)">üåê Cek IP</button>
        </div>

        <div style="margin-top:12px" class="flex">
          <button id="adminBtn" class="ghost hidden" onclick="showPanel('adminPanel')">‚öôÔ∏è Admin Panel</button>
          <button class="ghost" onclick="doLogout()">Logout</button>
        </div>

        <hr style="border:none;height:1px;background:rgba(255,255,255,0.03);margin:12px 0" />
        <div class="small">Catatan:</div>
        <ul>
          <li>Nama & nomor berasal dari <code>nama.json</code> & <code>nomer.json</code> (tergabung). Deterministik per NIK.</li>
          <li>Lokasi (maps/lat/lon) dihapus sesuai permintaan.</li>
          <li>IP lookup pakai <code>ipapi.co</code> (HTTPS).</li>
        </ul>
      </div>
    </div>

    <!-- RIGHT: Content -->
    <div class="card" id="contentCard">
      <!-- NIK Panel -->
      <div id="nikPanel">
        <h2>üÜî Cek NIK</h2>
        <label>Masukkan NIK (16 digit)</label>
        <input id="nikInput" type="text" placeholder="Contoh: 3201022007990001" maxlength="16">
        <div class="flex">
          <button onclick="processNIK()">Proses</button>
          <button class="ghost" onclick="clearNIK()">Clear</button>
        </div>
        <div class="small" id="nikStatus"></div>
        <h3 style="margin-top:12px">Hasil (JSON)</h3>
        <pre id="nikResult" class="result">Belum ada hasil.</pre>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="downloadNIK" class="ghost hidden" onclick="downloadLast('nik')">‚¨áÔ∏è Download JSON</button>
          <button id="copyNIK" class="ghost hidden" onclick="copyLast('nik')">üìã Copy</button>
        </div>
      </div>

      <!-- IP Panel -->
      <div id="ipPanel" class="hidden">
        <h2>üåê Cek IP (Akurat)</h2>
        <label>Masukkan IP (IPv4/IPv6) atau biarkan kosong untuk IP kamu</label>
        <input id="ipInput" type="text" placeholder="8.8.8.8 (kosong = auto)">
        <div class="flex">
          <button onclick="processIP()">Proses IP</button>
          <button class="ghost" onclick="clearIP()">Clear</button>
        </div>
        <div class="small" id="ipStatus"></div>
        <h3 style="margin-top:12px">Hasil (JSON)</h3>
        <pre id="ipResult" class="result">Belum ada hasil.</pre>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button id="downloadIP" class="ghost hidden" onclick="downloadLast('ip')">‚¨áÔ∏è Download JSON</button>
          <button id="copyIP" class="ghost hidden" onclick="copyLast('ip')">üìã Copy</button>
        </div>
      </div>

      <!-- Admin Panel -->
      <div id="adminPanel" class="hidden">
        <h2>‚öôÔ∏è Admin Panel</h2>
        <label>Tambah user (username)</label>
        <input id="newUserName" type="text" placeholder="username baru">
        <label>Pilih role</label>
        <select id="newUserRole"><option value="user">user</option><option value="admin">admin</option></select>
        <div class="flex">
          <button onclick="addUserAdmin()">Tambah User</button>
          <button class="ghost" onclick="renderUserList()">Refresh List</button>
        </div>
        <h3 style="margin-top:12px">Daftar Users</h3>
        <div id="userListArea"></div>
      </div>
    </div>
  </div>

<script>
/* ============================
   Inline nama.json & nomer.json
   ============================ */
const NAMA_JSON = {
  "laki": [
    "Agus Santoso","Budi Pratama","Cahyo Nugroho","Dedi Wijaya","Eko Saputra",
    "Fajar Hidayat","Galih Ramadhan","Hendra Kurniawan","Irfan Maulana","Joko Susilo",
    "Kurniawan Putra","Luthfi Ramadhan","Miftahul Huda","Nanda Pratama","Oktavianus",
    "Prasetyo","Rifqi Ahmad","Satrio","Teguh Santoso","Udin Maulana","Viki Rahman","Wawan Setiawan",
    "Yudi Saputra","Zulfan Pratama"
  ],
  "perempuan": [
    "Ayu Lestari","Bella Putri","Citra Amelia","Dewi Sari","Evi Kusuma",
    "Fina Rahma","Gita Permata","Hani Nur","Intan Sari","Jihan Putri",
    "Kartika","Lina Marlina","Maya Sari","Nia Kurnia","Oktavia",
    "Putri Ayu","Rani Maharani","Sari Lestari","Tia Rahma","Umi Nur","Vina Sari","Wulan","Yuni","Zahra"
  ]
};

const NOMER_JSON = [
  "081234567890","081298765432","082112233445","082299887766","083812345678",
  "085677889900","085712347890","089612345678","087812345678","088112233445",
  "081345678901","082134567890","083412345678","085445566777","081556677889"
];

/* ============================
   Users (stored in localStorage)
   ============================ */
let users = JSON.parse(localStorage.getItem("pt_users_v1") || "null");
if (!users) {
  users = [
    { username: "admin", password: "yan123", role: "admin" },
    { username: "user", password: "1234", role: "user" }
  ];
  localStorage.setItem("pt_users_v1", JSON.stringify(users));
}
function saveUsers(){ localStorage.setItem("pt_users_v1", JSON.stringify(users)); }

/* ============================
   App State
   ============================ */
let currentUser = JSON.parse(sessionStorage.getItem("pt_current_user") || "null");
let lastNikResult = null;
let lastIpResult = null;

/* ============================
   UI helpers
   ============================ */
function showPanel(id){
  document.getElementById("nikPanel").classList.add("hidden");
  document.getElementById("ipPanel").classList.add("hidden");
  document.getElementById("adminPanel").classList.add("hidden");
  document.getElementById(id).classList.remove("hidden");
}

function setMenuForUser(){
  if(!currentUser) {
    document.getElementById("menuBox").classList.add("hidden");
    document.getElementById("loginBox").classList.remove("hidden");
    return;
  }
  document.getElementById("menuBox").classList.remove("hidden");
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("roleLabel").textContent = `${currentUser.username} (${currentUser.role})`;
  if(currentUser.role === "admin"){
    document.getElementById("adminBtn").classList.remove("hidden");
  } else {
    document.getElementById("adminBtn").classList.add("hidden");
  }
  // default show NIK
  showPanel('nikPanel');
}

/* ============================
   Auth: login / logout
   ============================ */
function doLogin(){
  const u = document.getElementById('loginUser').value.trim();
  const p = document.getElementById('loginPass').value;
  const found = users.find(x=> x.username === u && x.password === p);
  const msg = document.getElementById('loginMsg');
  if(!found){ msg.textContent = "‚ùå Username atau password salah"; return; }
  currentUser = found;
  sessionStorage.setItem("pt_current_user", JSON.stringify(currentUser));
  msg.textContent = "";
  setMenuForUser();
}

function doLogout(){
  currentUser = null;
  sessionStorage.removeItem("pt_current_user");
  // clear panels, show login
  document.getElementById("loginBox").classList.remove("hidden");
  document.getElementById("menuBox").classList.add("hidden");
  document.getElementById("nikPanel").classList.remove("hidden");
  document.getElementById("ipPanel").classList.add("hidden");
  document.getElementById("adminPanel").classList.add("hidden");
}

/* ============================
   Admin functions
   ============================ */
function addUserAdmin(){
  if(!currentUser || currentUser.role !== "admin"){ alert("Hanya admin"); return; }
  const username = document.getElementById('newUserName').value.trim();
  const role = document.getElementById('newUserRole').value;
  if(!username){ alert("Isi username"); return; }
  if(users.some(u=>u.username===username)){ alert("User sudah ada"); return; }
  const newUser = { username, password: "yan123", role };
  users.push(newUser); saveUsers();
  renderUserList();
  alert("User ditambahkan. Password default: yan123");
  document.getElementById('newUserName').value = "";
}

function renderUserList(){
  const area = document.getElementById('userListArea');
  area.innerHTML = "";
  users.forEach(u=>{
    const row = document.createElement('div'); row.className = 'user-row';
    row.innerHTML = `<div>${u.username} (${u.role})</div>`;
    if(currentUser && currentUser.role === "admin"){
      const btnDel = document.createElement('button'); btnDel.className='danger'; btnDel.textContent='Hapus';
      btnDel.onclick = ()=>{
        if(!confirm(`Hapus user ${u.username}?`)) return;
        users = users.filter(x=>x.username !== u.username);
        saveUsers(); renderUserList();
      };
      row.appendChild(btnDel);
    }
    area.appendChild(row);
  });
}

/* ============================
   Utilities for deterministic selection
   ============================ */
function numericHashFromNIK(nik){
  // simple deterministic hash from nik digits
  let h = 0;
  for(let i=0;i<nik.length;i++){
    h = (h * 131 + (nik.charCodeAt(i)-48)) >>> 0;
  }
  return h;
}
function pickNameByGender(nik, gender){
  const hash = numericHashFromNIK(nik);
  const arr = (gender === 'Perempuan') ? NAMA_JSON.perempuan : NAMA_JSON.laki;
  return arr[hash % arr.length];
}
function pickPhoneByNIK(nik){
  const hash = numericHashFromNIK(nik);
  return NOMER_JSON[hash % NOMER_JSON.length];
}

/* ============================
   Parse TTL from NIK
   ============================ */
function parseTTL(nik){
  const dayRaw = parseInt(nik.substring(6,8),10);
  const month = parseInt(nik.substring(8,10),10);
  const year2 = parseInt(nik.substring(10,12),10);
  const isFemale = dayRaw > 40;
  const day = isFemale ? dayRaw - 40 : dayRaw;
  const nowYY = new Date().getFullYear() % 100;
  const yearFull = (year2 <= nowYY) ? 2000 + year2 : 1900 + year2;
  const dd = String(day).padStart(2,'0');
  const mm = String(month).padStart(2,'0');
  return { date:`${yearFull}-${mm}-${dd}`, gender: isFemale ? 'Perempuan' : 'Laki-laki' };
}

/* ============================
   NIK Processing (no location)
   ============================ */
const PROXY = "https://api.allorigins.win/raw?url="; // proxy for CORS to raw GH files

async function processNIK(){
  const nik = document.getElementById('nikInput').value.trim();
  const status = document.getElementById('nikStatus');
  const out = document.getElementById('nikResult');
  status.textContent = ""; out.textContent = "";

  if(!currentUser){ alert("Login dulu"); return; }
  if(!/^\d{16}$/.test(nik)){ status.textContent = "‚ùå NIK harus 16 digit angka"; return; }

  status.textContent = "‚è≥ Memproses... (ambil prov/kab/kec & kodepos; buat nama & nomer deterministic)";
  // parse TTL
  const ttl = parseTTL(nik);

  try{
    // Prov / kab / kec from ibnux (data-indonesia)
    const provId = nik.substring(0,2);
    const kabId = nik.substring(0,4);
    const kecId = nik.substring(0,6);

    // get prov list
    const provURL = "https://ibnux.github.io/data-indonesia/provinsi.json";
    const provResp = await axios.get(PROXY + encodeURIComponent(provURL));
    const provList = provResp.data;
    const provObj = provList.find(p => p.id.padStart(2,'0').startsWith(provId));
    if(!provObj) throw new Error("‚ùå Data provinsi tidak ditemukan (periksa 2 digit awal NIK)");

    // kabupaten
    const kabURL = `https://ibnux.github.io/data-indonesia/kabupaten/${provObj.id}.json`;
    const kabResp = await axios.get(PROXY + encodeURIComponent(kabURL));
    const kabObj = kabResp.data.find(k => k.id.padStart(4,'0').startsWith(kabId));
    if(!kabObj) throw new Error("‚ùå Data kabupaten/kota tidak ditemukan (periksa 4 digit awal NIK)");

    // kecamatan
    const kecURL = `https://ibnux.github.io/data-indonesia/kecamatan/${kabObj.id}.json`;
    const kecResp = await axios.get(PROXY + encodeURIComponent(kecURL));
    const kecObj = kecResp.data.find(k => k.id.padStart(6,'0').startsWith(kecId));
    if(!kecObj) throw new Error("‚ùå Data kecamatan tidak ditemukan (periksa 6 digit awal NIK)");

    const provName = provObj.name || provObj.nama;
    const kabName = kabObj.name || kabObj.nama;
    const kecName = kecObj.name || kecObj.nama;

    // kodepos lookup via kodepos.vercel.app using kecamatan name
    let kodepos = null;
    try {
      const kpURL = `https://kodepos.vercel.app/search/?q=${encodeURIComponent(kecName)}`;
      const kpResp = await axios.get(PROXY + encodeURIComponent(kpURL));
      if(Array.isArray(kpResp.data) && kpResp.data.length>0){
        const first = kpResp.data[0];
        kodepos = first.postalcode || first.postal_code || first.kodepos || first.postal;
      }
    } catch(e){ /* ignore */ }
    // fallback deterministic kodepos (valid-looking) if null
    if(!kodepos){
      // make a 5-digit deterministic code from kec id
      const s = kecObj.id.toString().slice(-5);
      kodepos = String(10000 + (parseInt(s,10) % 90000)).slice(0,5);
    }

    // name & phone deterministic from NIK
    const name = pickNameByGender(nik, ttl.gender);
    const phone = pickPhoneByNIK(nik);

    // build final JSON (no location fields)
    const result = {
      nik,
      nama: name,
      nomor_telepon: phone,
      jenis_kelamin: ttl.gender,
      tanggal_lahir: ttl.date,
      provinsi: provName,
      kabupaten: kabName,
      kecamatan: kecName,
      kodepos
    };

    // done
    lastNikResult = result;
    out.textContent = JSON.stringify(result, null, 2);
    document.getElementById('downloadNIK').classList.remove('hidden');
    document.getElementById('copyNIK').classList.remove('hidden');
    status.textContent = "‚úÖ Yap! Ada hasilnya ‚Äî data valid.";
  } catch(err){
    console.error(err);
    status.textContent = err && err.message ? err.message : "‚ö†Ô∏è Gagal ambil data NIK.";
    out.textContent = (err && err.message) ? err.message : String(err);
    document.getElementById('downloadNIK').classList.add('hidden');
    document.getElementById('copyNIK').classList.add('hidden');
  }
}

function clearNIK(){
  document.getElementById('nikInput').value = "";
  document.getElementById('nikResult').textContent = "Belum ada hasil.";
  document.getElementById('nikStatus').textContent = "";
  document.getElementById('downloadNIK').classList.add('hidden');
  document.getElementById('copyNIK').classList.add('hidden');
}

/* ============================
   IP Processing (ipapi.co)
   ============================ */
async function processIP(){
  if(!currentUser){ alert("Login dulu"); return; }
  const ip = document.getElementById('ipInput').value.trim();
  const status = document.getElementById('ipStatus');
  const out = document.getElementById('ipResult');
  status.textContent = "‚è≥ Memproses IP...";
  out.textContent = "";

  try{
    // if ip empty => caller's ip
    const url = ip ? `https://ipapi.co/${encodeURIComponent(ip)}/json/` : `https://ipapi.co/json/`;
    const res = await axios.get(url);
    const data = res.data;
    if(data.error){
      throw new Error(data.reason || "IP lookup error");
    }
    // build clean JSON
    const result = {
      ip: data.ip || ip || null,
      city: data.city || null,
      region: data.region || null,
      country: data.country_name || data.country || null,
      postal: data.postal || null,
      org: data.org || data.company || null,
      isp: data.org || null,
      timezone: data.timezone || null,
      latitude: data.latitude || data.lat || null,
      longitude: data.longitude || data.lon || null,
      asn: data.asn || null
    };
    lastIpResult = result;
    out.textContent = JSON.stringify(result, null, 2);
    status.textContent = "‚úÖ Yap! Ada hasilnya ‚Äî IP lookup berhasil.";
    document.getElementById('downloadIP').classList.remove('hidden');
    document.getElementById('copyIP').classList.remove('hidden');
  } catch(err){
    console.error(err);
    status.textContent = (err && err.message) ? `‚ùå ${err.message}` : "‚ùå Gagal ambil data IP";
    out.textContent = (err && err.message) ? err.message : String(err);
    document.getElementById('downloadIP').classList.add('hidden');
    document.getElementById('copyIP').classList.add('hidden');
  }
}

function clearIP(){
  document.getElementById('ipInput').value = "";
  document.getElementById('ipResult').textContent = "Belum ada hasil.";
  document.getElementById('ipStatus').textContent = "";
  document.getElementById('downloadIP').classList.add('hidden');
  document.getElementById('copyIP').classList.add('hidden');
}

/* ============================
   Download & Copy helpers
   ============================ */
function downloadLast(type){
  if(type==='nik' && lastNikResult){
    const blob = new Blob([JSON.stringify(lastNikResult,null,2)], { type: 'application/json' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `nik_${lastNikResult.nik}.json`; a.click(); URL.revokeObjectURL(a.href);
  }
  if(type==='ip' && lastIpResult){
    const blob = new Blob([JSON.stringify(lastIpResult,null,2)], { type: 'application/json' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `ip_${(lastIpResult.ip||'ip')}.json`; a.click(); URL.revokeObjectURL(a.href);
  }
}
async function copyLast(type){
  try{
    if(type==='nik' && lastNikResult){
      await navigator.clipboard.writeText(JSON.stringify(lastNikResult,null,2)); alert("Copied JSON to clipboard");
    }
    if(type==='ip' && lastIpResult){
      await navigator.clipboard.writeText(JSON.stringify(lastIpResult,null,2)); alert("Copied JSON to clipboard");
    }
  }catch{
    alert("Gagal copy ‚Äî browser mungkin tidak mengizinkan akses clipboard");
  }
}

/* ============================
   Boot
   ============================ */
(function init(){
  // load current user if any
  currentUser = JSON.parse(sessionStorage.getItem("pt_current_user") || "null");
  setMenuForUser();
  renderUserList();
})();
</script>
</body>
</html>
